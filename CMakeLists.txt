CMAKE_MINIMUM_REQUIRED(VERSION 3.16)
SET(CMAKE_CXX_STANDARD 17)
PROJECT(rtcfg)
OPTION(BUILD_TEST "build tests" OFF)

INCLUDE_DIRECTORIES(include)

FIND_PACKAGE(OpenSSL REQUIRED)
FIND_PACKAGE(CURL CONFIG REQUIRED)
FIND_PACKAGE(nlohmann_json CONFIG REQUIRED)
FIND_PACKAGE(spdlog CONFIG REQUIRED)
FIND_PACKAGE(fmt CONFIG REQUIRED)

AUX_SOURCE_DIRECTORY(src SRCS_DIRS)
AUX_SOURCE_DIRECTORY(src/constants SRCS_DIRS)
AUX_SOURCE_DIRECTORY(src/factory SRCS_DIRS)
AUX_SOURCE_DIRECTORY(src/model SRCS_DIRS)
AUX_SOURCE_DIRECTORY(src/service SRCS_DIRS)
AUX_SOURCE_DIRECTORY(src/http SRCS_DIRS)
AUX_SOURCE_DIRECTORY(src/utils SRCS_DIRS)
AUX_SOURCE_DIRECTORY(src/consul SRCS_DIRS)
AUX_SOURCE_DIRECTORY(src/consul/client SRCS_DIRS)
AUX_SOURCE_DIRECTORY(src/consul/data SRCS_DIRS)
AUX_SOURCE_DIRECTORY(src/consul/service SRCS_DIRS)
AUX_SOURCE_DIRECTORY(src/thread SRCS_DIRS)

SET(LIB_DEPS OpenSSL::SSL
        OpenSSL::Crypto
        CURL::libcurl
        nlohmann_json::nlohmann_json
        spdlog::spdlog
        fmt::fmt
)

ADD_LIBRARY(rtcfg ${SRCS_DIRS})
TARGET_LINK_LIBRARIES(rtcfg PRIVATE ${LIB_DEPS})

# install
INSTALL(TARGETS rtcfg LIBRARY DESTINATION lib)
INSTALL(DIRECTORY ${CMAKE_SOURCE_DIR}/include/
        DESTINATION include/rtcfg
        FILES_MATCHING PATTERN "*.h*")

# test
IF (BUILD_TEST)
    # TODO GTest
    INCLUDE(cmakes/sample.cmake)
    INCLUDE(cmakes/test.cmake)
    INCLUDE(cmakes/gtest.cmake)
ENDIF ()